import{a as _e}from"./chunk-C47NCUMU.js";import{a as se}from"./chunk-QZCNC4TM.js";import{a as pe,b as me}from"./chunk-7JUQ4SFG.js";import{a as O}from"./chunk-2DSX73W5.js";import{a as re,e as ne,f as oe}from"./chunk-4I6GP5KF.js";import"./chunk-777X4XMN.js";import"./chunk-3ACIU7HM.js";import{a as ve}from"./chunk-P7PN46JG.js";import{a as he}from"./chunk-XBFZP7YJ.js";import{a as Be,b as fe}from"./chunk-HMD5DIMH.js";import{a as ue,b as ye,c as ge,d as u}from"./chunk-AZV4S356.js";import{b as ie,d as ae}from"./chunk-UQVT5A5K.js";import{a as de,b as ce}from"./chunk-X3YUAQHH.js";import{a as X,b as Y,c as Z}from"./chunk-2CH4XR4M.js";import"./chunk-Y7EX3DHL.js";import{a as G}from"./chunk-ZNAIGONW.js";import{a as e,b as K,c as s}from"./chunk-AC5BHCOO.js";import{a as le}from"./chunk-GXIAPNSE.js";import{V as te}from"./chunk-UWZUNSGB.js";import{i as W,k as q,l as J,p as Q,y as ee}from"./chunk-UFIXWNDQ.js";import{Ba as B,Ca as M,Da as V,Db as f,Ea as j,Ib as H,Jb as C,Lb as x,Mb as A,Na as z,Nb as n,Ob as o,Pb as h,Rb as E,Ub as S,Wb as R,fc as d,gc as w,gd as $,hb as p,hc as D,jd as k,la as c,ra as b,rc as P,vc as L,xc as T,yb as I,yc as N,zc as U}from"./chunk-4E5X34BO.js";import"./chunk-SECEFDB3.js";import{f as be,g as y}from"./chunk-GAL4ENT6.js";var m=be(Be());var F={[s.UNKNOWN]:{title:"Recieve",total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[s.Serve]:{title:"Serve",total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[s.Recieve]:{title:"Recieve",total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[s.Attack]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[s.Block]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[s.Def]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[s.Set]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[s.Free]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}}};function Ce(r,g){if(r&1){let t=E();n(0,"li"),h(1,"hr"),n(2,"div",2),d(3),T(4,"date"),o(),n(5,"div",3),V(),n(6,"svg",4),h(7,"path",5),o()(),j(),n(8,"details",6)(9,"summary",7),d(10),o(),n(11,"ul",8)(12,"li")(13,"a",9),S("click",function(){let i=B(t).$implicit,v=R();return M(v.deleteAction(i.id))}),d(14,"Delete"),o()()()(),h(15,"hr"),o()}if(r&2){let t=g.$implicit;p(3),w(U(4,2,t.created_at,"short")),p(7),w(t==null||t.player_id==null?null:t.player_id.name)}}var Se=(()=>{class r{actionsService=c(O);actions=z.required();deleteAction(t){return y(this,null,function*(){return yield this.actionsService.deleteAction(t)})}static \u0275fac=function(a){return new(a||r)};static \u0275cmp=b({type:r,selectors:[["app-action-horizontal-timeline"]],inputs:{actions:[1,"actions"]},standalone:!0,features:[P],decls:4,vars:0,consts:[[1,"p-8","flex","max-w-full","overflow-x-scroll"],[1,"timeline"],[1,"timeline-start"],[1,"timeline-middle"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z","clip-rule","evenodd"],[1,"dropdown"],[1,"timeline-end","timeline-box"],[1,"menu","dropdown-content","bg-base-100","rounded-box","z-[1]","w-52","p-2","shadow"],[3,"click"]],template:function(a,i){a&1&&(n(0,"section",0)(1,"ul",1),x(2,Ce,16,5,"li",null,C),o()()),a&2&&(p(2),A(i.actions()))},dependencies:[k,$],styles:["[_nghost-%COMP%]{display:block}"]})}return r})();var xe=(r,g,t)=>[r,g,t];function Ae(r,g){if(r&1){let t=E();n(0,"button",10),S("click",function(){B(t);let i=R();return M(i.deleteEvent(i.game.id))}),n(1,"mat-icon"),d(2,"delete"),o()()}}function Ee(r,g){if(r&1&&(n(0,"mat-option",8),d(1),o()),r&2){let t=g.$implicit;f("value",t),p(),D(" ",t," ")}}var gt=(()=>{class r{ROUTES=G;export(){return y(this,null,function*(){})}activatedRoute=c(W);supabase=c(ee);actionsService=c(O);eventService=c(le);router=c(q);snack=c(se);currentSet;stats=F;kindS=ye;charts={perfectGradeRadar:{},worstGradeRadar:{}};grad_options_list=ge.map(t=>t.name);game;actions=[];gradePie={};playerPie={};sets=[1];hintMap=_e;groupedByKind=[];groupedByGrade=[];groupedByKindByPlayer;groupedByKindByGrade=[];groupedByKindByGradeAndPlayer;groupedByPlayer=[];gradDescriptionMap=u;groupedByGradeByKind;ngOnInit(){this.activatedRoute.data.subscribe(i=>y(this,[i],function*({game:t,actions:a}){let v=a;yield this.updateStats(a,t),this.sets=Array.from(new Set(v.map(_=>_.game_set)))})),this.actionsService.actions$.subscribe(t=>{this.reloadSet(this.currentSet)})}updateStats(t,a){return y(this,null,function*(){this.game=a,this.actions=t,this.groupedByPlayer=(0,m.sortBy)(Object.entries((0,m.groupBy)(t,"player_id.name")),i=>i[1]).reverse(),this.groupedByKind=Object.entries((0,m.groupBy)(t,"kind")),this.groupedByKindByPlayer=this.groupedByKind.map(i=>[i[0],(0,m.countBy)(i[1],"player_id.name")]),this.groupedByKindByGrade=this.groupedByKind.map(i=>[i[0],(0,m.countBy)(i[1],"grade")]),this.groupedByGradeByKind=this.groupedByGrade.map(i=>[i[0],(0,m.countBy)(i[1],"kind")]),this.groupedByKindByGradeAndPlayer=Object.entries((0,m.groupBy)(t,i=>`${i.kind}_${i.player_id?.name}`)).map(i=>[i[0],(0,m.groupBy)(i[1],"grade")]),this.generateGradeRadar()})}generateGradeRadar(t=this.actions){let a=t.filter(l=>l.grade===e["#"]),i=t.filter(l=>l.grade===e["="]),v=(0,m.countBy)(a,"kind"),_=this.groupedByGradeByKind.map(l=>({value:[l[1][s.Attack],l[1][s.Block],l[1][s.Def],l[1][s.Free],l[1][s.Recieve],l[1][s.Serve],l[1][s.Set]],name:u.get(l[0]),lineStyle:{color:K.get(l[0])},itemStyle:{color:K.get(l[0])}})),we=(0,m.countBy)(i,"kind");this.charts.perfectGradeRadar={title:{text:"Perfect/Failures ",show:!1},legend:{data:[u.get(e["#"]),u.get(e["!"]),u.get(e["+"]),u.get(e["/"]),u.get(e["-"]),u.get(e["="])]},radar:{indicator:ue.map(l=>({name:this.kindS.get(l.abbr),max:Math.max(...Object.values(v),...Object.values(we))}))},series:[{name:"Perfect vs Worst",type:"radar",data:[..._]}]}}convertPlayerCountMapToArray(t){return Array.from(t.entries()).sort((a,i)=>i[1]-a[1])}updateCharts(t){this.stats[t].charts||(this.stats[t].charts={gradePie:{},playerPie:{}}),this.stats[t].charts.gradePie={series:[]},this.stats[t].charts.gradePie.series=[{type:"pie",radius:"50%",data:Object.entries(this.stats[t].stats).map(a=>({value:a[1],name:a[0]}))}],this.stats[t].charts.playerPie={series:[]},this.stats[t].charts.playerPie.series=[{type:"pie",radius:"50%",data:Object.entries(this.stats[t].by_player).map(a=>({value:a[1],name:a[0]}))}]}reloadSet(t){return y(this,null,function*(){this.currentSet=t,this.game?.id&&(!t||t==="Alle"?this.actions=yield this.actionsService.getActionsOfEvent(this.game.id):this.actions=yield this.actionsService.getActionsOfEventOfSet(this.game.id,t),this.stats=F,this.updateStats(this.actions,this.game))})}deleteEvent(t){return y(this,null,function*(){try{yield this.eventService.deleteEvent(t),this.router.navigate([G.root,G.games])}catch{this.snack.open(X("error-deleteing-event"))}})}static \u0275fac=function(a){return new(a||r)};static \u0275cmp=b({type:r,selectors:[["app-game-game-detail-view"]],hostAttrs:[1,"flex","flex-col","p-5","gap-4"],standalone:!0,features:[P],decls:22,vars:15,consts:[[1,"flex","justify-between","items-center"],[1,"!text-sm","font-medium","truncate"],[1,"fixed","bottom-2","right-2","flex","flex-col","gap-2"],["mat-fab","",3,"routerLink"],["mat-fab",""],["id","export",1,"flex","flex-col","gap-8"],["formControlName","game_set",3,"valueChange","value"],["value","Alle"],[3,"value"],[3,"actions"],["mat-fab","",3,"click"]],template:function(a,i){a&1&&(n(0,"div",0)(1,"h1",1),d(2),o(),n(3,"div",2)(4,"button",3)(5,"mat-icon"),d(6,"add"),o()(),I(7,Ae,3,0,"button",4),o()(),n(8,"div",5)(9,"mat-form-field")(10,"mat-label"),d(11),T(12,"transloco"),o(),n(13,"mat-select",6),S("valueChange",function(_){return i.reloadSet(_)}),n(14,"mat-option",7),d(15,"Alle"),o(),x(16,Ee,2,2,"mat-option",8,C),o()(),h(18,"app-actions-by-kind",9)(19,"app-actions-by-grade",9)(20,"app-actions-by-player",9)(21,"app-action-horizontal-timeline",9),o()),a&2&&(p(2),w(i.game.title),p(2),f("routerLink",L(11,xe,i.ROUTES.root,i.ROUTES.dataentry,i.game.id)),p(3),H(i.game.owner&&i.game.id?7:-1),p(4),D("",N(12,9,"set"),":"),p(2),f("value","Alle"),p(3),A(i.sets),p(2),f("actions",i.actions),p(),f("actions",i.actions),p(),f("actions",i.actions),p(),f("actions",i.actions))},dependencies:[fe,ve,he,Se,k,Q,J,oe,ne,re,me,pe,te,ae,ie,ce,de,Z,Y],encapsulation:2})}return r})();export{gt as ReportDetailViewComponent};
