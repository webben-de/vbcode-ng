import{a as we}from"./chunk-C47NCUMU.js";import{a as fe}from"./chunk-KM5RK4ZX.js";import{a as he,b as ye}from"./chunk-IFOM4GZ5.js";import{a as D}from"./chunk-2YJGVCFK.js";import{a as de,e as ce,f as ue}from"./chunk-2635ERCO.js";import"./chunk-24KTCTAN.js";import"./chunk-3ACIU7HM.js";import{a as Se}from"./chunk-GZYKZDWF.js";import{a as Ce}from"./chunk-WRBHLAYA.js";import{a as _e}from"./chunk-AAAPLX4R.js";import{a as ve,b as ge}from"./chunk-AOFIJYTA.js";import{a as Be}from"./chunk-BCCPXHBQ.js";import{a as le,b as y}from"./chunk-JBTEI3DZ.js";import{b as pe,d as me}from"./chunk-2WGW7YKY.js";import{a as ee,b as te,c as ie,e as oe,f as se}from"./chunk-QIFNKBCP.js";import"./chunk-BZUA64OK.js";import{a as G}from"./chunk-ZNAIGONW.js";import{a as e,b as H,c as p}from"./chunk-AC5BHCOO.js";import{a as ne}from"./chunk-4MNG3POK.js";import{W as re}from"./chunk-TS2TU6VR.js";import{D as ae,i as J,k as Q,l as X,p as Y}from"./chunk-S6T5735P.js";import{Ab as L,Bc as B,Cc as I,Da as R,Dc as Z,Ea as T,Fa as C,Fb as f,Ga as N,Kb as K,Lb as w,Nb as b,Ob as M,Pa as $,Pb as s,Qb as n,Rb as g,Vb as k,Yb as x,_b as V,gb as W,jb as l,jc as c,kc as _,lc as j,ld as q,na as h,od as P,ta as A,vc as F,zc as O}from"./chunk-PRUKLSZG.js";import"./chunk-SECEFDB3.js";import{f as xe,i as v}from"./chunk-GK2WYAVW.js";var u=xe(Be());var U={[p.UNKNOWN]:{title:"Recieve",total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[p.Serve]:{title:"Serve",total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[p.Recieve]:{title:"Recieve",total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[p.Attack]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[p.Block]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[p.Def]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[p.Set]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[p.Free]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}}};function Ae(r,o){if(r&1){let m=k();s(0,"li"),g(1,"hr"),s(2,"div",2),c(3),B(4,"date"),n(),s(5,"div",3),C(),s(6,"svg",4),g(7,"path",5),n()(),N(),s(8,"details",6)(9,"summary",7),c(10),n(),s(11,"ul",8)(12,"li")(13,"a",9),x("click",function(){let a=R(m).$implicit,t=V();return T(t.deleteAction(a.id))}),c(14,"Delete"),n()()()(),g(15,"hr"),n()}if(r&2){let m=o.$implicit;l(3),_(Z(4,2,m.created_at,"short")),l(7),_(m==null||m.player_id==null?null:m.player_id.name)}}var be=(()=>{let o=class o{constructor(){this.actionsService=h(D),this.actions=$.required()}deleteAction(i){return v(this,null,function*(){return yield this.actionsService.deleteAction(i)})}};o.\u0275fac=function(a){return new(a||o)},o.\u0275cmp=A({type:o,selectors:[["app-action-horizontal-timeline"]],inputs:{actions:[1,"actions"]},standalone:!0,features:[F],decls:4,vars:0,consts:[[1,"p-8","flex","max-w-full","overflow-x-scroll"],[1,"timeline"],[1,"timeline-start"],[1,"timeline-middle"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z","clip-rule","evenodd"],[1,"dropdown"],[1,"timeline-end","timeline-box"],[1,"menu","dropdown-content","bg-base-100","rounded-box","z-[1]","w-52","p-2","shadow"],[3,"click"]],template:function(a,t){a&1&&(s(0,"section",0)(1,"ul",1),b(2,Ae,16,5,"li",null,w),n()()),a&2&&(l(2),M(t.actions()))},dependencies:[P,q],styles:["[_nghost-%COMP%]{display:block}"]});let r=o;return r})();var z=(r,o,m)=>[r,o,m];function Re(r,o){if(r&1){let m=k();s(0,"button",14),x("click",function(){R(m);let a=V();return T(a.deleteEvent(a.event.id))}),s(1,"mat-icon"),c(2,"delete"),n()()}}function Te(r,o){r&1&&(C(),s(0,"svg",16)(1,"title"),c(2,"youtube"),n(),g(3,"path",18),n())}function ke(r,o){r&1&&(C(),s(0,"svg",17)(1,"title"),c(2,"video-outline"),n(),g(3,"path",19),n())}function Ve(r,o){if(r&1&&(s(0,"li",8)(1,"a",15),L(2,Te,4,0,":svg:svg",16)(3,ke,4,0,":svg:svg",17),n()()),r&2){let m=o.$implicit;l(),f("href",m,W),l(),K(m.includes("youtube")?2:3)}}function Fe(r,o){if(r&1&&(s(0,"mat-option",12),c(1),n()),r&2){let m=o.$implicit;f("value",m),l(),j(" ",m," ")}}var Ct=(()=>{let o=class o{constructor(){this.ROUTES=G,this.activatedRoute=h(J),this.supabase=h(ae),this.actionsService=h(D),this.eventService=h(ne),this.router=h(Q),this.snack=h(fe),this.stats=U,this.kindS=ge,this.charts={perfectGradeRadar:{},worstGradeRadar:{}},this.grad_options_list=le.map(i=>i.name),this.actions=[],this.gradePie={},this.playerPie={},this.sets=[1],this.hintMap=we,this.groupedByKind=[],this.groupedByGrade=[],this.groupedByKindByGrade=[],this.groupedByPlayer=[],this.gradDescriptionMap=y}export(){return v(this,null,function*(){})}ngOnInit(){this.activatedRoute.data.subscribe(t=>v(this,[t],function*({game:i,actions:a}){let E=a;yield this.updateStats(a,i),this.sets=Array.from(new Set(E.map(S=>S.game_set)))})),this.actionsService.actions$.subscribe(i=>{this.reloadSet(this.currentSet)})}updateStats(i,a){return v(this,null,function*(){this.event=a,this.actions=i,this.groupedByPlayer=(0,u.sortBy)(Object.entries((0,u.groupBy)(i,"player_id.name")),t=>t[1]).reverse(),this.groupedByKind=Object.entries((0,u.groupBy)(i,"kind")),this.groupedByKindByPlayer=this.groupedByKind.map(t=>[t[0],(0,u.countBy)(t[1],"player_id.name")]),this.groupedByKindByGrade=this.groupedByKind.map(t=>[t[0],(0,u.countBy)(t[1],"grade")]),this.groupedByGradeByKind=this.groupedByGrade.map(t=>[t[0],(0,u.countBy)(t[1],"kind")]),this.groupedByKindByGradeAndPlayer=Object.entries((0,u.groupBy)(i,t=>`${t.kind}_${t.player_id?.name}`)).map(t=>[t[0],(0,u.groupBy)(t[1],"grade")]),this.generateGradeRadar()})}generateGradeRadar(i=this.actions){let a=i.filter(d=>d.grade===e["#"]),t=i.filter(d=>d.grade===e["="]),E=(0,u.countBy)(a,"kind"),S=this.groupedByGradeByKind.map(d=>({value:[d[1][p.Attack],d[1][p.Block],d[1][p.Def],d[1][p.Free],d[1][p.Recieve],d[1][p.Serve],d[1][p.Set]],name:y.get(d[0]),lineStyle:{color:H.get(d[0])},itemStyle:{color:H.get(d[0])}})),Me=(0,u.countBy)(t,"kind");this.charts.perfectGradeRadar={title:{text:"Perfect/Failures ",show:!1},legend:{data:[y.get(e["#"]),y.get(e["!"]),y.get(e["+"]),y.get(e["/"]),y.get(e["-"]),y.get(e["="])]},radar:{indicator:ve.map(d=>({name:this.kindS.get(d.abbr),max:Math.max(...Object.values(E),...Object.values(Me))}))},series:[{name:"Perfect vs Worst",type:"radar",data:[...S]}]}}convertPlayerCountMapToArray(i){return Array.from(i.entries()).sort((a,t)=>t[1]-a[1])}updateCharts(i){this.stats[i].charts||(this.stats[i].charts={gradePie:{},playerPie:{}}),this.stats[i].charts.gradePie={series:[]},this.stats[i].charts.gradePie.series=[{type:"pie",radius:"50%",data:Object.entries(this.stats[i].stats).map(a=>({value:a[1],name:a[0]}))}],this.stats[i].charts.playerPie={series:[]},this.stats[i].charts.playerPie.series=[{type:"pie",radius:"50%",data:Object.entries(this.stats[i].by_player).map(a=>({value:a[1],name:a[0]}))}]}reloadSet(i){return v(this,null,function*(){this.currentSet=i,this.event?.id&&(!i||i==="Alle"?this.actions=yield this.actionsService.getActionsOfEvent(this.event.id):this.actions=yield this.actionsService.getActionsOfEventOfSet(this.event.id,i),this.stats=U,this.updateStats(this.actions,this.event))})}deleteEvent(i){return v(this,null,function*(){try{yield this.eventService.deleteEvent(i),this.router.navigate([G.root,G.games])}catch{this.snack.open(ee("error-deleteing-event"))}})}};o.\u0275fac=function(a){return new(a||o)},o.\u0275cmp=A({type:o,selectors:[["app-game-game-detail-view"]],hostAttrs:[1,"flex","flex-col","p-5","gap-4"],standalone:!0,features:[F],decls:32,vars:28,consts:[[1,"flex","justify-between","items-center"],[1,"!text-sm","font-medium","truncate"],[1,"fixed","bottom-2","right-2","flex","flex-col","gap-2"],["mat-fab","",3,"routerLink"],["mat-fab",""],[1,"flex","w-full","justify-between"],[1,"btn","btn-outline-primary",3,"routerLink"],[1,"flex","gap-2"],[1,"flex","items-center","justify-center"],["id","export",1,"flex","flex-col","gap-8"],["formControlName","game_set",3,"valueChange","value"],["value","Alle"],[3,"value"],[3,"actions"],["mat-fab","",3,"click"],["target","_blank",1,"btn","btn-xs","w-12","h-12",3,"href"],["width","48","height","48","viewBox","0 0 48 48"],["width","48","height","48"],["d","M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z",1,"fill-[#FF0000]"],["d","M15,8V16H5V8H15M16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5V7A1,1 0 0,0 16,6Z"]],template:function(a,t){a&1&&(s(0,"div",0)(1,"h1",1),c(2),n(),s(3,"div",2)(4,"button",3)(5,"mat-icon"),c(6,"add"),n()(),s(7,"button",3)(8,"mat-icon"),c(9,"edit"),n()(),L(10,Re,3,0,"button",4),n()(),s(11,"div",5)(12,"a",6),c(13),B(14,"transloco"),n(),s(15,"ul",7),b(16,Ve,4,2,"li",8,w),n()(),s(18,"div",9)(19,"mat-form-field")(20,"mat-label"),c(21),B(22,"transloco"),n(),s(23,"mat-select",10),x("valueChange",function(S){return t.reloadSet(S)}),s(24,"mat-option",11),c(25,"Alle"),n(),b(26,Fe,2,2,"mat-option",12,w),n()(),g(28,"app-actions-by-kind",13)(29,"app-actions-by-grade",13)(30,"app-actions-by-player",13)(31,"app-action-horizontal-timeline",13),n()),a&2&&(l(2),_(t.event.title),l(2),f("routerLink",O(16,z,t.ROUTES.root,t.ROUTES.dataentry,t.event.id)),l(3),f("routerLink",O(20,z,t.ROUTES.root,t.ROUTES.editGame,t.event.id)),l(3),K(t.event.owner&&t.event.id?10:-1),l(2),f("routerLink",O(24,z,t.ROUTES.root,t.ROUTES.roationPlaner,t.event.id)),l(),_(I(14,12,"rotation-planer")),l(3),M(t.event.media_links),l(5),j("",I(22,14,"set"),":"),l(2),f("value","Alle"),l(3),M(t.sets),l(2),f("actions",t.actions),l(),f("actions",t.actions),l(),f("actions",t.actions),l(),f("actions",t.actions))},dependencies:[_e,Se,Ce,be,P,Y,X,ue,ce,de,ye,he,re,me,pe,se,oe,ie,te],encapsulation:2});let r=o;return r})();export{Ct as ReportDetailViewComponent};
