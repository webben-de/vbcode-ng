import{a as Me}from"./chunk-OISROXUG.js";import{a as ve}from"./chunk-QAVGAAVW.js";import{d as ye,h as ge,i as _e}from"./chunk-OPJQ2HU6.js";import"./chunk-HOEGX7HV.js";import{a as D}from"./chunk-T2ST5RQA.js";import{D as fe,E as he,w as ue}from"./chunk-PBBD6Q2O.js";import"./chunk-NQBBWANC.js";import{a as we}from"./chunk-YR6PECMG.js";import{a as Ee}from"./chunk-XKZG3YNT.js";import{a as be}from"./chunk-56YVSHIG.js";import{a as Se,b as Ce}from"./chunk-3JFCGLZY.js";import{a as Re}from"./chunk-BSKFGMFV.js";import{a as ce,b as v}from"./chunk-7BRDTTBX.js";import{d as oe,e as se}from"./chunk-4ORLU33K.js";import{a as ae,b as ne,c as re,e as le,f as me}from"./chunk-E7WDJHTT.js";import"./chunk-XRBHPGUZ.js";import{a as G}from"./chunk-XGPREJ5I.js";import{a as e,b as U,c as l}from"./chunk-Q2CI2HOH.js";import{a as de}from"./chunk-ZJ67X65J.js";import"./chunk-KB2SVANO.js";import{N as pe,f as Q,i as X,s as Y,u as ee,v as te,z as ie}from"./chunk-ZURVRTZ6.js";import{$c as J,Mb as L,Mc as F,Nb as K,Ob as w,Oc as x,Pc as H,Qb as E,Qc as q,Rb as M,Sb as f,Tb as d,Ub as s,Vb as k,Wb as g,Xb as _,Yb as V,ac as O,eb as W,ec as j,fc as Z,gb as o,gc as P,ma as h,ta as A,ua as R,va as b,vc as c,wa as $,wc as S,xb as T,xc as I}from"./chunk-BYLMW57F.js";import"./chunk-SECEFDB3.js";import{f as Ae,i as y}from"./chunk-GK2WYAVW.js";var u=Ae(Re());var z={[l.UNKNOWN]:{title:"Recieve",total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Serve]:{title:"Serve",total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Recieve]:{title:"Recieve",total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Attack]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Block]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Def]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Set]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Free]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}}};function ke(n,r){if(n&1){let m=O();g(0,"li"),V(1,"hr"),g(2,"div",2),c(3),x(4,"date"),_(),g(5,"div",3),b(),g(6,"svg",4),V(7,"path",5),_()(),$(),g(8,"details",6)(9,"summary",7),c(10),_(),g(11,"ul",8)(12,"li")(13,"a",9),Z("click",function(){let a=A(m).$implicit,t=P();return R(t.deleteAction(a.id))}),c(14,"Delete"),_()()()(),V(15,"hr"),_()}if(n&2){let m=r.$implicit;o(3),S(q(4,2,m.created_at,"short")),o(7),S(m==null||m.player_id==null?null:m.player_id.name)}}var xe=(()=>{let r=class r{constructor(){this.actionsService=h(D),this.actions=J.required()}deleteAction(i){return y(this,null,function*(){return yield this.actionsService.deleteAction(i)})}};r.\u0275fac=function(a){return new(a||r)},r.\u0275cmp=T({type:r,selectors:[["app-action-horizontal-timeline"]],inputs:{actions:[1,"actions"]},decls:4,vars:0,consts:[[1,"p-8","flex","max-w-full","overflow-x-scroll"],[1,"timeline"],[1,"timeline-start"],[1,"timeline-middle"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z","clip-rule","evenodd"],[1,"dropdown"],[1,"timeline-end","timeline-box"],[1,"menu","dropdown-content","bg-base-100","rounded-box","z-[1]","w-52","p-2","shadow"],[3,"click"]],template:function(a,t){a&1&&(g(0,"section",0)(1,"ul",1),E(2,ke,16,5,"li",null,w),_()()),a&2&&(o(2),M(t.actions()))},dependencies:[X,Q],styles:["[_nghost-%COMP%]{display:block}"]});let n=r;return n})();var N=(n,r,m)=>[n,r,m];function Ve(n,r){if(n&1){let m=O();d(0,"button",14),j("click",function(){A(m);let a=P();return R(a.deleteEvent(a.event.id))}),d(1,"mat-icon"),c(2,"delete"),s()()}}function Oe(n,r){n&1&&(b(),d(0,"svg",16)(1,"title"),c(2,"youtube"),s(),k(3,"path",18),s())}function Pe(n,r){n&1&&(b(),d(0,"svg",17)(1,"title"),c(2,"video-outline"),s(),k(3,"path",19),s())}function Fe(n,r){if(n&1&&(d(0,"li",8)(1,"a",15),L(2,Oe,4,0,":svg:svg",16)(3,Pe,4,0,":svg:svg",17),s()()),n&2){let m=r.$implicit;o(),f("href",m,W),o(),K(m.includes("youtube")?2:3)}}function Ge(n,r){if(n&1&&(d(0,"mat-option",12),c(1),s()),n&2){let m=r.$implicit;f("value",m),o(),I(" ",m," ")}}var bt=(()=>{let r=class r{constructor(){this.ROUTES=G,this.activatedRoute=h(Y),this.supabase=h(pe),this.actionsService=h(D),this.eventService=h(de),this.router=h(ee),this.snack=h(ve),this.stats=z,this.kindS=Ce,this.charts={perfectGradeRadar:{},worstGradeRadar:{}},this.grad_options_list=ce.map(i=>i.name),this.actions=[],this.gradePie={},this.playerPie={},this.sets=[1],this.hintMap=Me,this.groupedByKind=[],this.groupedByGrade=[],this.groupedByKindByGrade=[],this.groupedByPlayer=[],this.gradDescriptionMap=v}export(){return y(this,null,function*(){})}ngOnInit(){this.activatedRoute.data.subscribe(t=>y(this,[t],function*({game:i,actions:a}){let B=a;yield this.updateStats(a,i),this.sets=Array.from(new Set(B.map(C=>C.game_set)))})),this.actionsService.actions$.subscribe(i=>{this.reloadSet(this.currentSet)})}updateStats(i,a){return y(this,null,function*(){this.event=a,this.actions=i,this.groupedByPlayer=(0,u.sortBy)(Object.entries((0,u.groupBy)(i,"player_id.name")),t=>t[1]).reverse(),this.groupedByKind=Object.entries((0,u.groupBy)(i,"kind")),this.groupedByKindByPlayer=this.groupedByKind.map(t=>[t[0],(0,u.countBy)(t[1],"player_id.name")]),this.groupedByKindByGrade=this.groupedByKind.map(t=>[t[0],(0,u.countBy)(t[1],"grade")]),this.groupedByGradeByKind=this.groupedByGrade.map(t=>[t[0],(0,u.countBy)(t[1],"kind")]),this.groupedByKindByGradeAndPlayer=Object.entries((0,u.groupBy)(i,t=>`${t.kind}_${t.player_id?.name}`)).map(t=>[t[0],(0,u.groupBy)(t[1],"grade")]),this.generateGradeRadar()})}generateGradeRadar(i=this.actions){let a=i.filter(p=>p.grade===e["#"]),t=i.filter(p=>p.grade===e["="]),B=(0,u.countBy)(a,"kind"),C=this.groupedByGradeByKind.map(p=>({value:[p[1][l.Attack],p[1][l.Block],p[1][l.Def],p[1][l.Free],p[1][l.Recieve],p[1][l.Serve],p[1][l.Set]],name:v.get(p[0]),lineStyle:{color:U.get(p[0])},itemStyle:{color:U.get(p[0])}})),Be=(0,u.countBy)(t,"kind");this.charts.perfectGradeRadar={title:{text:"Perfect/Failures ",show:!1},legend:{data:[v.get(e["#"]),v.get(e["!"]),v.get(e["+"]),v.get(e["/"]),v.get(e["-"]),v.get(e["="])]},radar:{indicator:Se.map(p=>({name:this.kindS.get(p.abbr),max:Math.max(...Object.values(B),...Object.values(Be))}))},series:[{name:"Perfect vs Worst",type:"radar",data:[...C]}]}}convertPlayerCountMapToArray(i){return Array.from(i.entries()).sort((a,t)=>t[1]-a[1])}updateCharts(i){this.stats[i].charts||(this.stats[i].charts={gradePie:{},playerPie:{}}),this.stats[i].charts.gradePie={series:[]},this.stats[i].charts.gradePie.series=[{type:"pie",radius:"50%",data:Object.entries(this.stats[i].stats).map(a=>({value:a[1],name:a[0]}))}],this.stats[i].charts.playerPie={series:[]},this.stats[i].charts.playerPie.series=[{type:"pie",radius:"50%",data:Object.entries(this.stats[i].by_player).map(a=>({value:a[1],name:a[0]}))}]}reloadSet(i){return y(this,null,function*(){this.currentSet=i,this.event?.id&&(!i||i==="Alle"?this.actions=yield this.actionsService.getActionsOfEvent(this.event.id):this.actions=yield this.actionsService.getActionsOfEventOfSet(this.event.id,i),this.stats=z,this.updateStats(this.actions,this.event))})}deleteEvent(i){return y(this,null,function*(){try{yield this.eventService.deleteEvent(i),this.router.navigate([G.root,G.games])}catch{this.snack.open(ae("error-deleteing-event"))}})}};r.\u0275fac=function(a){return new(a||r)},r.\u0275cmp=T({type:r,selectors:[["app-game-game-detail-view"]],hostAttrs:[1,"flex","flex-col","p-5","gap-4"],decls:32,vars:28,consts:[[1,"flex","justify-between","items-center"],[1,"!text-sm","font-medium","truncate"],[1,"fixed","bottom-2","right-2","flex","flex-col","gap-2"],["mat-fab","",3,"routerLink"],["mat-fab",""],[1,"flex","w-full","justify-between"],[1,"btn","btn-outline-primary",3,"routerLink"],[1,"flex","gap-2"],[1,"flex","items-center","justify-center"],["id","export",1,"flex","flex-col","gap-8"],["formControlName","game_set",3,"valueChange","value"],["value","Alle"],[3,"value"],[3,"actions"],["mat-fab","",3,"click"],["target","_blank",1,"btn","btn-xs","w-12","h-12",3,"href"],["width","48","height","48","viewBox","0 0 48 48"],["width","48","height","48"],["d","M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z",1,"fill-[#FF0000]"],["d","M15,8V16H5V8H15M16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5V7A1,1 0 0,0 16,6Z"]],template:function(a,t){a&1&&(d(0,"div",0)(1,"h1",1),c(2),s(),d(3,"div",2)(4,"button",3)(5,"mat-icon"),c(6,"add"),s()(),d(7,"button",3)(8,"mat-icon"),c(9,"edit"),s()(),L(10,Ve,3,0,"button",4),s()(),d(11,"div",5)(12,"a",6),c(13),x(14,"transloco"),s(),d(15,"ul",7),E(16,Fe,4,2,"li",8,w),s()(),d(18,"div",9)(19,"mat-form-field")(20,"mat-label"),c(21),x(22,"transloco"),s(),d(23,"mat-select",10),j("valueChange",function(C){return t.reloadSet(C)}),d(24,"mat-option",11),c(25,"Alle"),s(),E(26,Ge,2,2,"mat-option",12,w),s()(),k(28,"app-actions-by-kind",13)(29,"app-actions-by-grade",13)(30,"app-actions-by-player",13)(31,"app-action-horizontal-timeline",13),s()),a&2&&(o(2),S(t.event.title),o(2),f("routerLink",F(16,N,t.ROUTES.root,t.ROUTES.dataentry,t.event.id)),o(3),f("routerLink",F(20,N,t.ROUTES.root,t.ROUTES.editGame,t.event.id)),o(3),K(t.event.owner&&t.event.id?10:-1),o(2),f("routerLink",F(24,N,t.ROUTES.root,t.ROUTES.roationPlaner,t.event.id)),o(),S(H(14,12,"rotation-planer")),o(3),M(t.event.media_links),o(5),I("",H(22,14,"set"),":"),o(2),f("value","Alle"),o(3),M(t.sets),o(2),f("actions",t.actions),o(),f("actions",t.actions),o(),f("actions",t.actions),o(),f("actions",t.actions))},dependencies:[be,we,Ee,xe,ie,te,he,fe,ue,_e,ge,ye,se,oe,me,le,re,ne],encapsulation:2});let n=r;return n})();export{bt as ReportDetailViewComponent};
