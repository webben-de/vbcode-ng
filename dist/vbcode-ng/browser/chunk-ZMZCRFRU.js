import{a as _e}from"./chunk-C47NCUMU.js";import{a as de}from"./chunk-DPZRDEGH.js";import{a as ue,b as fe}from"./chunk-R3GIKCAV.js";import{a as F}from"./chunk-VFP2DDOR.js";import{a as me,e as pe,f as ce}from"./chunk-BEXHPWTT.js";import"./chunk-55CRI4HG.js";import"./chunk-3ACIU7HM.js";import{a as ve}from"./chunk-ZP6ZHXG4.js";import{a as Se}from"./chunk-KK2AFB7K.js";import{a as ge}from"./chunk-JQ3ZNENG.js";import{a as he,b as ye}from"./chunk-AOFIJYTA.js";import{a as xe}from"./chunk-BCCPXHBQ.js";import{a as oe,b as h}from"./chunk-JBTEI3DZ.js";import{b as se,d as le}from"./chunk-DEREL4HB.js";import{a as re,b as ne}from"./chunk-NAQPVQ54.js";import{a as Y,b as Z,c as ee}from"./chunk-GSBOXZT7.js";import"./chunk-4R3SIY6Y.js";import{a as G}from"./chunk-ZNAIGONW.js";import{a as e,b as K,c as l}from"./chunk-AC5BHCOO.js";import{a as ie}from"./chunk-6U7GO4WO.js";import{W as ae}from"./chunk-4VPFC4IH.js";import{D as te,i as q,k as J,l as Q,p as X}from"./chunk-A6DT7CBD.js";import{Ca as x,Da as B,Db as g,Ea as j,Fa as I,Ib as L,Jb as C,Lb as A,Mb as E,Nb as o,Oa as z,Ob as s,Pb as v,Rb as R,Ub as _,Wb as k,fc as u,gc as w,gd as W,hb as p,hc as D,jd as O,ma as f,rc as P,sa as M,vc as N,xc as T,yb as H,yc as U,zc as $}from"./chunk-ZDK7RG5R.js";import"./chunk-SECEFDB3.js";import{f as Me,i as y}from"./chunk-GK2WYAVW.js";var d=Me(xe());var V={[l.UNKNOWN]:{title:"Recieve",total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Serve]:{title:"Serve",total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Recieve]:{title:"Recieve",total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Attack]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Block]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Def]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Set]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}},[l.Free]:{total:0,by_player:new Map,stats:{[e["#"]]:0,[e["+"]]:0,[e["!"]]:0,[e["/"]]:0,[e["-"]]:0,[e["="]]:0}}};function Ce(n,r){if(n&1){let c=R();o(0,"li"),v(1,"hr"),o(2,"div",2),u(3),T(4,"date"),s(),o(5,"div",3),j(),o(6,"svg",4),v(7,"path",5),s()(),I(),o(8,"details",6)(9,"summary",7),u(10),s(),o(11,"ul",8)(12,"li")(13,"a",9),_("click",function(){let a=x(c).$implicit,i=k();return B(i.deleteAction(a.id))}),u(14,"Delete"),s()()()(),v(15,"hr"),s()}if(n&2){let c=r.$implicit;p(3),w($(4,2,c.created_at,"short")),p(7),w(c==null||c.player_id==null?null:c.player_id.name)}}var we=(()=>{let r=class r{constructor(){this.actionsService=f(F),this.actions=z.required()}deleteAction(t){return y(this,null,function*(){return yield this.actionsService.deleteAction(t)})}};r.\u0275fac=function(a){return new(a||r)},r.\u0275cmp=M({type:r,selectors:[["app-action-horizontal-timeline"]],inputs:{actions:[1,"actions"]},standalone:!0,features:[P],decls:4,vars:0,consts:[[1,"p-8","flex","max-w-full","overflow-x-scroll"],[1,"timeline"],[1,"timeline-start"],[1,"timeline-middle"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z","clip-rule","evenodd"],[1,"dropdown"],[1,"timeline-end","timeline-box"],[1,"menu","dropdown-content","bg-base-100","rounded-box","z-[1]","w-52","p-2","shadow"],[3,"click"]],template:function(a,i){a&1&&(o(0,"section",0)(1,"ul",1),A(2,Ce,16,5,"li",null,C),s()()),a&2&&(p(2),E(i.actions()))},dependencies:[O,W],styles:["[_nghost-%COMP%]{display:block}"]});let n=r;return n})();var Ae=(n,r,c)=>[n,r,c];function Ee(n,r){if(n&1){let c=R();o(0,"button",10),_("click",function(){x(c);let a=k();return B(a.deleteEvent(a.game.id))}),o(1,"mat-icon"),u(2,"delete"),s()()}}function Re(n,r){if(n&1&&(o(0,"mat-option",8),u(1),s()),n&2){let c=r.$implicit;g("value",c),p(),D(" ",c," ")}}var gt=(()=>{let r=class r{constructor(){this.ROUTES=G,this.activatedRoute=f(q),this.supabase=f(te),this.actionsService=f(F),this.eventService=f(ie),this.router=f(J),this.snack=f(de),this.stats=V,this.kindS=ye,this.charts={perfectGradeRadar:{},worstGradeRadar:{}},this.grad_options_list=oe.map(t=>t.name),this.actions=[],this.gradePie={},this.playerPie={},this.sets=[1],this.hintMap=_e,this.groupedByKind=[],this.groupedByGrade=[],this.groupedByKindByGrade=[],this.groupedByPlayer=[],this.gradDescriptionMap=h}export(){return y(this,null,function*(){})}ngOnInit(){this.activatedRoute.data.subscribe(i=>y(this,[i],function*({game:t,actions:a}){let b=a;yield this.updateStats(a,t),this.sets=Array.from(new Set(b.map(S=>S.game_set)))})),this.actionsService.actions$.subscribe(t=>{this.reloadSet(this.currentSet)})}updateStats(t,a){return y(this,null,function*(){this.game=a,this.actions=t,this.groupedByPlayer=(0,d.sortBy)(Object.entries((0,d.groupBy)(t,"player_id.name")),i=>i[1]).reverse(),this.groupedByKind=Object.entries((0,d.groupBy)(t,"kind")),this.groupedByKindByPlayer=this.groupedByKind.map(i=>[i[0],(0,d.countBy)(i[1],"player_id.name")]),this.groupedByKindByGrade=this.groupedByKind.map(i=>[i[0],(0,d.countBy)(i[1],"grade")]),this.groupedByGradeByKind=this.groupedByGrade.map(i=>[i[0],(0,d.countBy)(i[1],"kind")]),this.groupedByKindByGradeAndPlayer=Object.entries((0,d.groupBy)(t,i=>`${i.kind}_${i.player_id?.name}`)).map(i=>[i[0],(0,d.groupBy)(i[1],"grade")]),this.generateGradeRadar()})}generateGradeRadar(t=this.actions){let a=t.filter(m=>m.grade===e["#"]),i=t.filter(m=>m.grade===e["="]),b=(0,d.countBy)(a,"kind"),S=this.groupedByGradeByKind.map(m=>({value:[m[1][l.Attack],m[1][l.Block],m[1][l.Def],m[1][l.Free],m[1][l.Recieve],m[1][l.Serve],m[1][l.Set]],name:h.get(m[0]),lineStyle:{color:K.get(m[0])},itemStyle:{color:K.get(m[0])}})),be=(0,d.countBy)(i,"kind");this.charts.perfectGradeRadar={title:{text:"Perfect/Failures ",show:!1},legend:{data:[h.get(e["#"]),h.get(e["!"]),h.get(e["+"]),h.get(e["/"]),h.get(e["-"]),h.get(e["="])]},radar:{indicator:he.map(m=>({name:this.kindS.get(m.abbr),max:Math.max(...Object.values(b),...Object.values(be))}))},series:[{name:"Perfect vs Worst",type:"radar",data:[...S]}]}}convertPlayerCountMapToArray(t){return Array.from(t.entries()).sort((a,i)=>i[1]-a[1])}updateCharts(t){this.stats[t].charts||(this.stats[t].charts={gradePie:{},playerPie:{}}),this.stats[t].charts.gradePie={series:[]},this.stats[t].charts.gradePie.series=[{type:"pie",radius:"50%",data:Object.entries(this.stats[t].stats).map(a=>({value:a[1],name:a[0]}))}],this.stats[t].charts.playerPie={series:[]},this.stats[t].charts.playerPie.series=[{type:"pie",radius:"50%",data:Object.entries(this.stats[t].by_player).map(a=>({value:a[1],name:a[0]}))}]}reloadSet(t){return y(this,null,function*(){this.currentSet=t,this.game?.id&&(!t||t==="Alle"?this.actions=yield this.actionsService.getActionsOfEvent(this.game.id):this.actions=yield this.actionsService.getActionsOfEventOfSet(this.game.id,t),this.stats=V,this.updateStats(this.actions,this.game))})}deleteEvent(t){return y(this,null,function*(){try{yield this.eventService.deleteEvent(t),this.router.navigate([G.root,G.games])}catch{this.snack.open(Y("error-deleteing-event"))}})}};r.\u0275fac=function(a){return new(a||r)},r.\u0275cmp=M({type:r,selectors:[["app-game-game-detail-view"]],hostAttrs:[1,"flex","flex-col","p-5","gap-4"],standalone:!0,features:[P],decls:22,vars:15,consts:[[1,"flex","justify-between","items-center"],[1,"!text-sm","font-medium","truncate"],[1,"fixed","bottom-2","right-2","flex","flex-col","gap-2"],["mat-fab","",3,"routerLink"],["mat-fab",""],["id","export",1,"flex","flex-col","gap-8"],["formControlName","game_set",3,"valueChange","value"],["value","Alle"],[3,"value"],[3,"actions"],["mat-fab","",3,"click"]],template:function(a,i){a&1&&(o(0,"div",0)(1,"h1",1),u(2),s(),o(3,"div",2)(4,"button",3)(5,"mat-icon"),u(6,"add"),s()(),H(7,Ee,3,0,"button",4),s()(),o(8,"div",5)(9,"mat-form-field")(10,"mat-label"),u(11),T(12,"transloco"),s(),o(13,"mat-select",6),_("valueChange",function(S){return i.reloadSet(S)}),o(14,"mat-option",7),u(15,"Alle"),s(),A(16,Re,2,2,"mat-option",8,C),s()(),v(18,"app-actions-by-kind",9)(19,"app-actions-by-grade",9)(20,"app-actions-by-player",9)(21,"app-action-horizontal-timeline",9),s()),a&2&&(p(2),w(i.game.title),p(2),g("routerLink",N(11,Ae,i.ROUTES.root,i.ROUTES.dataentry,i.game.id)),p(3),L(i.game.owner&&i.game.id?7:-1),p(4),D("",U(12,9,"set"),":"),p(2),g("value","Alle"),p(3),E(i.sets),p(2),g("actions",i.actions),p(),g("actions",i.actions),p(),g("actions",i.actions),p(),g("actions",i.actions))},dependencies:[ge,ve,Se,we,O,X,Q,ce,pe,me,fe,ue,ae,le,se,ne,re,ee,Z],encapsulation:2});let n=r;return n})();export{gt as ReportDetailViewComponent};
