<!-- Generated by SpecStory, Markdown v2.0.0 -->

<!-- vscode Session 16612cd6-f24c-42e0-8010-16ff2b97c42a (2025-02-05 10:30Z) -->

# Updating route parameters with rotationSlider value (2025-02-05 10:30Z)

_**User (2025-02-05 10:32Z)**_

please reflect the current rotationSlider value in the route path so a reload will recover the value

---

_**Agent**_

To reflect the current `rotationSlider` value in the route path, you can update the route parameters whenever the `rotationSlider` value changes. Here's how you can do it:

1. Inject the `Router` and `ActivatedRoute` services.
2. Subscribe to changes in the `rotationSlider` value.
3. Update the route parameters with the new `rotationSlider` value.

Here's the updated code for `RotationPlanerPageComponent`:

```typescript
import { CommonModule } from '@angular/common';
import { Component, type ElementRef, type OnInit, ViewChild, inject } from '@angular/core';
import { FormsModule, ReactiveFormsModule } from '@angular/forms';
import { MatFormFieldModule } from '@angular/material/form-field';
import { MatIconModule } from '@angular/material/icon';
import { MatSelectModule } from '@angular/material/select';
import { MatSlideToggleModule } from '@angular/material/slide-toggle';
import { MatSliderModule } from '@angular/material/slider';
import { MatSnackBar } from '@angular/material/snack-bar';
import { ActivatedRoute, Router, RouterModule } from '@angular/router';
import { TranslocoModule } from '@jsverse/transloco';
import { select } from '@ngxs/store';
import { find, without } from 'lodash';
import { interval, takeWhile } from 'rxjs';
import { SVB_APP_ROUTES } from '../app/ROUTES';
import { SessionState } from '../app/session.state';
import { EventsService } from '../services/events.service';
import { MetadataService } from '../services/metadata.service';
import { PlayerService } from '../services/player.service';
import type { ActionDTO } from '../types/ActionDTO';
import type { EventDTO, EventResponse, createEventDTO } from '../types/EventDTO';
import type { PlayerDTO } from '../types/PlayerDTO';
import { RotationGridItemComponent } from './atoms/vbGridItem.component';

@Component({
  selector: 'app-rotation-planer',
  host: { class: 'w-full flex h-full' },
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    RouterModule,
    ReactiveFormsModule,
    MatFormFieldModule,
    MatSelectModule,
    MatSliderModule,
    MatSlideToggleModule,
    MatIconModule,
    RotationGridItemComponent,
    TranslocoModule,
  ],
  template: `
    <div class="flex flex-col w-full h-full p-5 justify-center gap-8">
      <div class="flex flex-col">
        <mat-form-field>
          <mat-label>{{ 'event' | transloco }}</mat-label>
          <mat-select placeholder="Select Game" [(ngModel)]="selectedEvent" (valueChange)="handleGameChange($event)">
            @for (item of events|async; track $index) {
            <mat-option [value]="item.id">
              {{ item.title }}
            </mat-option>
            }
          </mat-select>
        </mat-form-field>
        <div class="flex justify-between">
          @if(session()?.user?.id === event?.owner) {
          <a [routerLink]="[ROUTES.root + ROUTES.editGame, selectedEvent]">{{ 'edit-this-event' | transloco }}</a>
          <button class="btn w-16 h-8" (click)="copyLinkToClipboard()">
            <mat-icon class="text-primary">link</mat-icon>
          </button>
          }
        </div>
      </div>
      <hr />
      @if (event) {
      <div class="flex flex-col justify-evenly gap-4">
        <h6 class="text-md">{{ 'setter' | transloco }}: {{ convertRoationCountToSetterPosition }}</h6>
        <mat-slide-toggle #toggleTrikot [checked]="true">
          <span class="!text-primary">
            {{ 'show' | transloco }} {{ toggleTrikot.checked ? ('Trikotnumber' | transloco) : ('BasePosition' | transloco) }}</span
          ></mat-slide-toggle
        >
        <div class="grid grid-cols-3 gap-8 grid-rows-2 justify-center  border-2 p-8 ">
          <app-grid-item [currentRotation]="slider" [index]="1" [toggleTrikot]="toggleTrikot.checked" [roatedPlayer]="roatedPlayer" />
          <app-grid-item [currentRotation]="slider" [index]="2" [toggleTrikot]="toggleTrikot.checked" [roatedPlayer]="roatedPlayer" />
          <app-grid-item [currentRotation]="slider" [index]="3" [toggleTrikot]="toggleTrikot.checked" [roatedPlayer]="roatedPlayer" />
          <app-grid-item [currentRotation]="slider" [index]="4" [toggleTrikot]="toggleTrikot.checked" [roatedPlayer]="roatedPlayer" />
          <app-grid-item [currentRotation]="slider" [index]="5" [toggleTrikot]="toggleTrikot.checked" [roatedPlayer]="roatedPlayer" />
          <app-grid-item [currentRotation]="slider" [index]="6" [toggleTrikot]="toggleTrikot.checked" [roatedPlayer]="roatedPlayer" />
        </div>
        <input
          type="range"
          min="1"
          max="6"
          value="1"
          class="range range-accent"
          [(ngModel)]="rotationSlider"
          [class.tooltip]="!hasMoved"
          (ngModelChange)="onRotationSliderChange($event)"
          class="tooltip tooltip-open tooltip-secondary"
          data-tip="move to stop auto-rotation"
          #rangeSlider
        />
        @if (!hasMoved) {
        <p>{{ 'move-the-slider-preview-each-rotation-on-the-curt' | transloco }}</p>
        }
        <hr />
        <h3>Bank</h3>
        <div class="grid grid-cols-6 gap-2 grid-rows-1 justify-center">
          @for(b of bank; track $index){
          <div class="flex flex-col justify-center items-center gap-2 border border-1 p-3 ">
            <div class="bg-neutral rounded-box text-neutral-content flex flex-col p-2">
              <span class="countdown font-league text-5xl text-center text-primary">
                <span style="--value:{{ b?.trikot }};"></span>
              </span>
            </div>
            <label class="swap font-league uppercase ">
              {{ b?.name }}
            </label>
          </div>
          }
        </div>
        <h3>Notes</h3>
        <textarea
          class="textarea "
          placeholder="Bio"
          style="field-sizing: content;"
          [value]="event.notes || ''"
          (change)="updateNotes(notes)"
          #notes
          [disabled]="event.owner !== session()?.user?.id"
        ></textarea>
      </div>
      }@else {
      <div class="flex flex-col items-center">
        <mat-icon class="!h-20 ">swipe_up</mat-icon>
        <p>{{ 'please-select-an-event-to-see-information-here' | transloco }}</p>
      </div>
      }
    </div>
  `,
})
export class RotationPlanerPageComponent implements OnInit {
  rotationSlider = 1;
  selectedEvent?: string;
  lastAction?: ActionDTO;
  hasMoved = false;
  bank: (PlayerDTO | undefined)[] = [];
  ROUTES = SVB_APP_ROUTES;
  router = inject(Router);
  snack = inject(MatSnackBar);
  meta = inject(MetadataService);
  route = inject(ActivatedRoute);
  eventService = inject(EventsService);
  playerService = inject(PlayerService);
  session = select(SessionState.session);
  @ViewChild('rangeSlider') rangeSlider!: ElementRef<HTMLInputElement>;
  events = this.eventService.getEvents();
  event?: EventResponse;
  roationPlayerBasePositions?: PlayerDTO[];

  get slider() {
    return String(this.rotationSlider);
  }

  get convertRoationCountToSetterPosition() {
    switch (this.rotationSlider) {
      case 1:
        return 1;
      case 2:
        return 6;
      case 3:
        return 5;
      case 4:
        return 4;
      case 5:
        return 3;
      case 6:
        return 2;
    }
    return 0;
  }

  async ngOnInit(): Promise<void> {
    this.route.data.subscribe(async (data) => {
      this.event = data['game'];
      this.selectedEvent = this.event?.id;
      await this.updateProps();
      this.meta.updateMetadata(
        {
          title: `${this.event?.title}-> Rotation Planer`,
          description: 'Plan your rotation for your next game',
          type: 'website',
        },
        true
      );
    });

    this.route.params.subscribe((params) => {
      if (params['rotation']) {
        this.rotationSlider = +params['rotation'];
      }
    });

    interval(4000)
      .pipe(takeWhile(() => !this.hasMoved))
      .subscribe(() => {
        if (this.rotationSlider === 6) this.rotationSlider = 1;
        else this.rotationSlider += 1;
      });
  }

  onRotationSliderChange(value: number) {
    this.rotationSlider = value;
    this.router.navigate([], {
      relativeTo: this.route,
      queryParams: { rotation: this.rotationSlider },
      queryParamsHandling: 'merge',
    });
  }

  private async updateProps() {
    const playerRoationObjectMap = new Map<string | number, PlayerDTO>();
    if (!this.event) return;
    this.router.navigate([SVB_APP_ROUTES.root + SVB_APP_ROUTES.roationPlaner, this.event.id]);
    const home_roation_ids = Object.entries(this.event?.home_team_start_rotation!);
    const rotationids = Object.values(Object.fromEntries(home_roation_ids));
    const players = await this.playerService.getPlayerList([...home_roation_ids.map((i) => i[1]), ...without(this.event.attendees, ...rotationids)]);
    home_roation_ids.forEach(([key, value]) => {
      playerRoationObjectMap.set(Number(key), players.find((p) => p.id === value)!);
    });
    this.roatedPlayer = playerRoationObjectMap;
    this.bank = without(this.event.attendees, ...rotationids).map((id) => find(players, { id }));
  }

  async handleGameChange($event: string) {
    this.event = await this.eventService.getEvent($event);
    this.updateProps();
  }

  async updateNotes(_t71: HTMLTextAreaElement) {
    try {
      await this.eventService.createEvent({ ...this.event, notes: _t71.value } as any);
    } catch (error) {
      this.snack.open('Error saving Note', 'OK', { duration: 2000 });
    }
  }

  copyLinkToClipboard() {
    navigator.clipboard.writeText(document.location.href);
    this.snack.open('Copy to clipboard');
  }
}
```

In this code, the `onRotationSliderChange` method updates the route parameters whenever the `rotationSlider` value changes. The `ngOnInit` method subscribes to route parameter changes to set the initial `rotationSlider` value from the route.

---

